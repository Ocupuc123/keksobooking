(()=>{var e={248:()=>{const e="is-invalid",t={1:["1"],2:["2","1"],3:["3","2","1"],100:["0"]},r=document.querySelector("#title"),o=document.querySelector("#price"),n=document.querySelector("#room_number"),a=document.querySelector("#capacity"),c=document.querySelector(".ad-form__submit"),s=t=>{t.parentElement.classList.add(e)},i=t=>{t.parentElement.classList.remove(e)};r.addEventListener("input",(e=>{const t=r.value.length;t<30||t>100?s(e.target):i(e.target),e.target.reportValidity()})),r.addEventListener("invalid",(e=>{e.target.validity.valueMissing&&s(e.target)})),o.addEventListener("invalid",(e=>{e.target.validity.valueMissing&&s(e.target)})),o.addEventListener("input",(e=>{const t=+e.target.value;t<+e.target.min||t>1e6?s(e.target):i(e.target),e.target.reportValidity()}));const l=(e,r)=>{[...r.options].forEach((r=>{t[e.value].includes(r.value)?r.disabled=!1:r.disabled=!0})),t[e.value].includes(r.value)?i(r):s(r),r.reportValidity()};n.addEventListener("change",(()=>{l(n,a)})),a.addEventListener("change",(()=>{l(n,a)})),c.addEventListener("click",(e=>{const t=document.querySelector(".ad-form").checkValidity();l(n,a),t||e.preventDefault()}))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{"use strict";r(248);const e=document.querySelector("#card").content.querySelector(".popup"),t=e=>{const t=document.querySelector(`#${e}`).content.querySelector(`.${e}`).cloneNode(!0);t.style.zIndex=1e3,document.body.append(t);const r=e=>{(e=>"Escape"===e.key||"Esc"===e.key)(e)&&(t.remove(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),document.addEventListener("click",(()=>{t.remove()}))},o="https://23.javascript.pages.academy/keksobooking",n=["gif","png","jpeg","jpg"],a=document.querySelector("#avatar"),c=document.querySelector(".ad-form-header__preview img"),s=document.querySelector("#images"),i=document.querySelector(".ad-form__photo"),l="ad-form--disabled",u="map__filters--disabled",d=document.querySelector(".map__filters"),p=document.querySelector(".ad-form"),m=p.querySelector(".ad-form__reset"),y=d.querySelectorAll("select"),v=d.querySelectorAll("fieldset"),g=p.querySelectorAll("fieldset"),f=p.querySelector("#price"),h=p.querySelector("#type"),S=p.querySelector(".ad-form__element--time"),q=p.querySelector("#timeout"),E=p.querySelector("#timein"),b=p.querySelector(".ad-form__slider"),x=()=>{switch(h.value){case"palace":return 1e4;case"flat":return 1e3;case"house":return 5e3;case"bungalow":return 0}};f.min=x(),f.placeholder=x(),h.addEventListener("change",(()=>{f.min=x(),f.placeholder=x()})),S.addEventListener("change",(e=>{e.target.matches("#timeout")?E.value=q.value:e.target.matches("#timein")&&(q.value=E.value)}));const w=()=>{p.querySelectorAll(".is-invalid").forEach((e=>{e.classList.remove("is-invalid")})),p.reset(),d.reset(),c.src="img/muffin-grey.svg",(()=>{const e=i.querySelector("img");e&&e.remove()})()},k="any",$=document.querySelector(".map__filters"),T=$.querySelector("#housing-type"),U=$.querySelector("#housing-price"),A=$.querySelector("#housing-rooms"),C=$.querySelector("#housing-guests"),M=$.querySelector("#housing-features"),D={LOW:{min:"0",max:"10000"},MIDDLE:{min:"10000",max:"50000"},HIGH:{min:"50000",max:"100000"}},F=({offer:e})=>e.type===T.value||T.value===k,H=({offer:e})=>Number(e.rooms)===Number(A.value)||A.value===k,N=({offer:e})=>Number(e.guests)===Number(C.value)||C.value===k,j=({offer:e})=>{const t=U.value;return t===k||e.price>D[t.toUpperCase()].min&&e.price<D[t.toUpperCase()].max},z=({offer:e})=>{const t=M.querySelectorAll("input:checked");if(0===t.length)return!0;if(e.features){const r=e.features;return Array.from(t).every((e=>r.includes(e.value)))}},V=e=>{const t=(e=>{const t=[];for(const r of e){if(t.length>=10)break;F(r)&&H(r)&&N(r)&&j(r)&&z(r)&&t.push(r)}return t})(e);B(t)},R=document.querySelector("#map-canvas"),I=document.querySelector(".ad-form").querySelector("#address"),O=[35.68283,139.75945],W=L.map(R,{scrollWheelZoom:!1}).setView(O,13);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>'}).addTo(W);const G=L.marker(O,{icon:L.icon({iconUrl:"./vendors/leaflet/images/main-pin.svg",iconSize:[52,52],iconAnchor:[25,52]}),draggable:!0}),P=L.layerGroup().addTo(W),Z=t=>t.forEach((t=>(t=>{const{location:r}=t;L.marker([r.lat,r.lng],{icon:L.icon({iconUrl:"./vendors/leaflet/images/pin.svg",iconSize:[40,40],iconAnchor:[20,40]})}).addTo(P).bindPopup((({author:t,offer:r})=>{const o=e.cloneNode(!0);try{o.querySelector(".popup__type").textContent=(e=>{switch(e){case"palace":return"Дворец";case"house":return"Дом";case"bungalow":return"Бунгало";case"flat":return"Квартира";case"hotel":return"Отель";default:throw new Error(`Неизвестный тип жилья ${e}`)}})(r.type)}catch(e){o.querySelector(".popup__type").textContent=`${e.message}`}return o.querySelector(".popup__avatar").src=t.avatar,o.querySelector(".popup__title").textContent=r.title,o.querySelector(".popup__text--address").textContent=r.address,o.querySelector(".popup__text--price").innerHTML=`${r.price} <span>₽/ночь</span>`,o.querySelector(".popup__text--capacity").innerHTML=`${r.rooms} комнаты для ${r.guests} гостей`,o.querySelector(".popup__text--time").innerHTML=`Заезд после ${r.checkin}, выезд до ${r.checkout}`,r.features?o.querySelector(".popup__features").innerHTML=r.features.map((e=>`<li class="popup__feature popup__feature--${e}"></li>`)).join(""):o.querySelector(".popup__features").remove(),r.description?o.querySelector(".popup__description").textContent=r.description:o.querySelector(".popup__description").remove(),r.photos?o.querySelector(".popup__photos").innerHTML=r.photos.map((e=>`<img src="${e}" class="popup__photo" width="45" height="40" alt="Фотография жилья" />`)).join(""):o.querySelector(".popup__photos").remove(),o})(t))})(t))),B=e=>{P.clearLayers(),Z(e)},J=()=>{G.setLatLng(O),I.value=`${O}`,W.setView(O,13)},K=e=>{var t;Z(e.slice(0,10)),d.classList.remove(u),v.forEach((e=>{e.disabled=!1})),y.forEach((e=>{e.disabled=!1})),t=e,$.addEventListener("change",_.debounce((()=>V(t)),500)),$.addEventListener("reset",_.debounce((()=>V(t)),500))},Q=document.querySelector(".ad-form__slider"),X=document.querySelector("#price"),Y=document.querySelector("#type"),ee=e=>Number(e.min),te=e=>Number(e.max);var re,oe,ne;p.classList.add(l),d.classList.add(u),g.forEach((e=>{e.disabled=!0})),v.forEach((e=>{e.disabled=!0})),y.forEach((e=>{e.disabled=!0})),W.whenReady((()=>{var e;p.classList.remove(l),g.forEach((e=>{e.disabled=!1})),e=K,fetch(`${o}/data`).then((e=>e.json())).then((t=>e(t))).catch((()=>{(e=>{const t=document.createElement("div");t.style.zIndex=1e3,t.style.position="fixed",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})("Ошибка загрузки данных")}))})),I.value=`${O}`,G.addTo(W),G.on("moveend",(e=>{const{lat:t,lng:r}=e.target.getLatLng();I.value=`${t.toFixed(5)}, ${r.toFixed(5)}`})),noUiSlider.create(Q,{start:0,step:1,connect:"lower",format:{to:e=>e.toFixed(0),from:e=>parseFloat(e)},range:{min:ee(X),max:te(X)}}),Q.noUiSlider.on("update",(e=>{X.value=e})),Y.addEventListener("change",(()=>{Q.noUiSlider.updateOptions({range:{min:ee(X),max:te(X)}}),Q.noUiSlider.set(Q.noUiSlider.get())})),re=()=>{w(),J(),t("success")},oe=()=>{t("error")},p.addEventListener("submit",(e=>{e.preventDefault(),(async(e,t,r)=>{fetch(o,{method:"POST",body:r}).then((r=>{r.ok?e():t()})).catch(t)})((()=>re()),(()=>oe()),new FormData(e.target))})),ne=()=>{w(),J()},m.addEventListener("click",(e=>{e.preventDefault(),b.noUiSlider.reset(),ne()})),a.addEventListener("change",(e=>{const t=e.target.files[0],r=t.name.toLowerCase();if(n.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{c.src=e.result})),e.readAsDataURL(t)}})),s.addEventListener("change",(e=>{const t=e.target.files[0],r=t.name.toLowerCase();if(n.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{const t=document.createElement("img");t.style.width="100%",t.style.height="100%",t.style.objectFit="cover",t.src=e.result,i.style.overflow="hidden",i.innerHTML="",i.append(t)})),e.readAsDataURL(t)}}))})()})();
//# sourceMappingURL=main.bundle.js.map